{% extends "layout.html" %}
{% block title %}Dashboard{% endblock %}
{% block header %}Dashboard{% endblock %}

{% block content %}
  <!-- 1) Metrik Kartları -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    <div class="bg-white p-6 rounded shadow text-center">
      <span class="text-3xl font-bold">{{ total_customers }}</span>
      <p class="text-gray-600">Toplam Müşteri</p>
    </div>
    <div class="bg-white p-6 rounded shadow text-center">
      <span class="text-3xl font-bold">{{ total_stocks }}</span>
      <p class="text-gray-600">Toplam Stok Kaydı</p>
    </div>
    <div class="bg-white p-6 rounded shadow text-center">
      <span class="text-3xl font-bold">{{ total_messages }}</span>
      <p class="text-gray-600">Toplam Mesaj</p>
    </div>
  </div>

 <!-- Zaman Tüneli -->
<div class="bg-white rounded shadow mb-6">
  <div class="px-6 py-4 border-b">
    <h2 class="text-lg font-semibold">Zaman Tüneli</h2>
  </div>
  <div
    id="timeline"
    class="p-6 max-h-64 overflow-y-auto space-y-4"
    onscroll="if(this.scrollTop + this.clientHeight >= this.scrollHeight - 10) loadMoreActivities()"
  >
    {% if activities %}
      {% for act in activities %}
        {% set status = (
             act.action.endswith('Bekliyor')   and 'Bekliyor'
           or act.action.endswith('Aktif')      and 'Aktif'
           or act.action.endswith('Tamamlandı') and 'Tamamlandı'
           or act.action.endswith('Askıya alındı') and 'Askıya alındı'
           or 'Diğer'
        ) %}
        <div class="flex items-start space-x-3">
          <span class="inline-block w-3 h-3 rounded-full
            {% if status == 'Bekliyor' %}bg-yellow-500{% endif %}
            {% if status == 'Aktif'    %}bg-green-500{% endif %}
            {% if status == 'Tamamlandı'%}bg-gray-400{% endif %}
            {% if status == 'Askıya alındı'%}bg-red-500{% endif %}
          "></span>
          <div>
            <div class="text-sm text-gray-500">
              {{ act.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}
            </div>
            <div class="text-sm">
              {{ act.action }}
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p class="text-gray-600 italic">Henüz etkinlik kaydı yok.</p>
    {% endif %}
  </div>
</div>

  <!-- 3) Chart’lar -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="bg-white p-6 rounded shadow">
      <h3 class="mb-4 font-medium">Görev Durumları</h3>
      <canvas id="tasksChart"></canvas>
    </div>
    <div class="bg-white p
-6 rounded shadow">
      <h3 class="mb-4 font-medium">Müşteri Dağılımı</h3>
      <canvas id="customersChart"></canvas>
    </div>
  </div>

{% endblock %}
